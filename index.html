<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>Turbolinks</title>
<meta content='A framework for easily creating beautiful presentations using HTML' name='description'>
<meta content='Megan Bowra-Dean &lt;megan@rabidtech.co.nz&gt;' name='author'>
<meta content='yes' name='apple-mobile-web-app-capable'>
<meta content='black-translucent' name='apple-mobile-web-app-status-bar-style'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport'>
<link href='css/reveal.min.css' rel='stylesheet'>
<link href='css/theme/night.css' id='theme' rel='stylesheet'>
<!-- For syntax highlighting -->
<link href='lib/css/zenburn.css' rel='stylesheet'>
<!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
  document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
</script>
<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->
</head>
<body>
<div class='reveal'>
<!-- Any section element inside of this container is displayed as a slide -->
<div class='slides'>
<section>
<h1>Turbolinks</h1>
<h2>More like TurboSTINKS</h2>
</section>
<section>
<h2>What is Turbolinks</h2>
<ul>
<li class='fragment'>Introduced as a default gem in Rails 4</li>
<li class='fragment'>Uses AJAX to swap out title and body of page when navigating</li>
<li class='fragment'>Provides caching</li>
<li class='fragment'>Can speed up page load on JS/CSS heavy sites up to 2x</li>
</ul>
</section>
<section>
<h2>Normal Page Lifecycle</h2>
<ul>
<li>
Someone clicks on a link
<br>
<img class='fragment' height='150px' src='img/nuke.jpg'>
</li>
<li class='fragment'>All page context is lost</li>
<li class='fragment'>Standard lifecycle callbacks are called (e.g. document ready as used by jQuery)</li>
</ul>
</section>
<section>
<h2>Turbolinks Page Lifecycle</h2>
<ul>
<li>&lt;title&gt; and &lt;body&gt; elements have their contents replaced removing any child elements from the DOM</li>
<li>However the JavaScript engine's context is preserved.</li>
<li>Since we can't rely on the standard lifecycle alternate callbacks are provided</li>
</ul>
</section>
<section>
<ul>
<li>
<code>page:before-change</code>
&mdash; a Turbolinks-enabled link has been clicked
</li>
<li>
<code>page:fetch</code>
&mdash; starting to fetch a new target page
</li>
<li>
<code>page:receive</code>
&mdash; the page has been fetched from the server, but not yet parsed
</li>
<li>
<code>page:change</code>
&mdash; the page has been parsed and changed to the new version
</li>
<li>
<code>page:update</code>
&mdash; is triggered whenever page:change is PLUS on jQuery's ajaxSucess
</li>
<li>
<code>page:load</code>
&mdash; is fired at the end of the loading process.
</li>
</ul>
</section>
<section>
<h2>Third Party Scripts</h2>
<h3>i.e. where this all falls down</h3>
</section>
<section>
<ul>
<li>
Third party scripts like Facebook's JS SDK, Google Maps etc. expect the standard page behaviour
</li>
<li>
Most of the time will not reinitialise between Turbolinks page changes
</li>
</ul>
</section>
<section>
<p>
This requires us to hunt down initialisation code in obfuscated, minified scripts in order to hook them into Turbolinks' page:load event.
</p>
<p>
<em>
Even doing that isn't enough.
</em>
</p>
</section>
<section>
<ul>
<li>
Since JavaScript context is preserved, any objects created in that context are preserved across page changes.
</li>
<li>
This leaves garbage state and dead DOM references for the third party scripts.
</li>
</ul>
</section>
<section>
<h2>This way leads madness</h2>
<p>
The
<em>Turbolinks Compatibility project</em>
provides some examples of popular third party scripts made compatible with Turbolinks
</p>
</section>
<section>
<h2>Facebook JS SDK</h2>
<p>Official code</p>
<pre><code>&lt;div id=&quot;fb-root&quot;&gt;&lt;/div&gt;
&lt;script&gt;
  (function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = &quot;//connect.facebook.net/en_US/all.js#xfbml=1&quot;;
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
&lt;/script&gt;</code></pre>
</section>
<section>
<section>
<h2>Facebook JS SDK</h2>
<p>Turbolinks compatible code (Coffeescript)</p>
<pre><code class='language-coffeescript'>fb_root = null&#x000A;fb_events_bound = false&#x000A;&#x000A;$ ->&#x000A;  loadFacebookSDK()&#x000A;  bindFacebookEvents() unless fb_events_bound&#x000A;&#x000A;bindFacebookEvents = ->&#x000A;  $(document)&#x000A;    .on('page:fetch', saveFacebookRoot)&#x000A;    .on('page:change', restoreFacebookRoot)&#x000A;    .on('page:load', ->&#x000A;      FB?.XFBML.parse()&#x000A;    )&#x000A;  fb_events_bound = true</code></pre>
</section>
<section>
<p>Continued</p>
<pre><code class='language-coffeescript'>saveFacebookRoot = ->&#x000A;  fb_root = $('#fb-root').detach()&#x000A;&#x000A;restoreFacebookRoot = ->&#x000A;  if $('#fb-root').length > 0&#x000A;    $('#fb-root').replaceWith fb_root&#x000A;  else&#x000A;    $('body').append fb_root&#x000A;&#x000A;loadFacebookSDK = ->&#x000A;  window.fbAsyncInit = initializeFacebookSDK&#x000A;  $.getScript("//connect.facebook.net/en_US/all.js#xfbml=1")</code></pre>
</section>
<section>
<p>Continued</p>
<pre><code class='language-coffeescript'>initializeFacebookSDK = ->&#x000A;  FB.init&#x000A;    appId     : 'YOUR_APP_ID'&#x000A;    channelUrl: '//WWW.YOUR_DOMAIN.COM/channel.html'&#x000A;    status    : true&#x000A;    cookie    : true&#x000A;    xfbml     : true&#x000A;</code></pre>
</section>
</section>
<section>
<h3>There are still issues even when thinking everything is correctly initialised</h3>
</section>
<section>
<p>Using the example on Turbolinks Compatibility for the ShareThis social media library, Rabid found that URLs were not being detected by the library correctly. ShareThis always thought it was on the page last hard refreshed by the client.</p>
</section>
<section>
<h2>Summary</h2>
<ul>
<li>Turbolinks does improve performance of client heavy web apps.</li>
<li>A few third party scripts work, with a lot of extra work on the part of the developer.</li>
<li>Others just don't or quickly become too maintenance heavy to justify the performance increase.</li>
<li>
<span style='text-decoration: line-through;'>
Turbolinks ate my homework, kicked my dog and killed my brother
</span>
</li>
</ul>
</section>
<section>
<p>
Good news is, it's easy to get rid of. Remove the references to it from your Gemfile and application.js and you're home free.
</p>
</section>
<section>
<h2>Megan Bowra-Dean</h2>
<h4>megan@rabidtech.co.nz</h4>
<h4>@megahbite</h4>
</section>
</div>
</div>
<script src='lib/js/head.min.js'></script>
<script src='js/reveal.js'></script>
<script>
  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    controls: true,
    progress: true,
    history: true,
    center: true,
  
    theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
  
    // Parallax scrolling
    // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
    // parallaxBackgroundSize: '2100px 900px',
  
    // Optional libraries used to extend on reveal.js
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]
  });
</script>
</body>
</html>
